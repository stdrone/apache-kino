<div id="video_container" onclick="mp_stop();">
	<video id="vplayer" controls="true">
		<source id="video_src" src="">
	</video>
</div>
<script>

function mp_play(link) {
	document.getElementById("video_src").src = link.href;
	document.getElementById("video_container").style.visibility = "visible";
	document.getElementById("vplayer").load();
	document.getElementById("vplayer").play();
	gDiv.style = "";
	return false;
}

function mp_stop() {
	document.getElementById("video_container").style.visibility = "";
	document.getElementById("video_src").src = "";
	document.getElementById("vplayer").load();
}

window.mobilecheck = function() {
	var check = check == undefined ? (/.*android.*/mi).test(navigator.userAgent) : checked;
	return check;
}

var playerInstance;

var gDiv;
var gLoaded;



var gRequest;

function request(url,params) {
  //var gRequest;
  if(gRequest !== undefined && gRequest.readyState !== 4) {
    gRequest.abort();
  }
  gDiv.innerHTML = "<div><img src='https://3.bp.blogspot.com/-eeiu8xL2Qls/UQaimEebl4I/AAAAAAAAFO8/hSK_kq7C8Po/s1600/loading9.gif'></div>";
  return new Promise(function (resolve, reject) {
    gRequest = new XMLHttpRequest();
    //gRequest.timeout = 2000;
    gRequest.onreadystatechange = function(e) {
      if (gRequest.readyState === 4) {
        if (gRequest.status === 200) {
          resolve(gRequest.response)
        } else {
          reject(gRequest.status)
        }
      }
    }
    gRequest.ontimeout = function () {
      reject('timeout')
    }
    gRequest.open('POST', url, true)
    data = "";
    for(var key in params) {
        if(data != "") data += "&";
          data += key + "=" + encodeURIComponent(params[key]);
        }
    gRequest.send(data);
  })
}


async function ajax(url,params) {
	var response;
	try {
		response = await request(url, params);
	} catch(err) {
		return;
	}
	if(document.getElementById("video_container").style.visibility != "visible") {
		if(response == "")
			gDiv.style = "";
		else
			gDiv.style = "display: block";
		while(gDiv.children[0] != undefined) gDiv.children[0].remove();
		var newDiv = document.createElement('div');
		newDiv.innerHTML = response;
		if(newDiv.children[0].getAttribute('name') == gLoaded) {
			gDiv.innerHTML = newDiv.innerHTML;
		}
	}
}

function get_file(file) {
	var dir_name = window.location.href.split("/")[4];
	if(dir_name != "") file = decodeURIComponent(dir_name);
	if(file == "Parent Directory" || file == "Name")
	{
		gDiv.style = "";
		return;
	}
	gLoaded = file;
	ajax("/.info.php",{"MOV": file});
}

function get_change(file) {
	var id_mov = document.getElementById("CHANGE").value;
	ajax("/.info.php",{"MOV": file, "CHANGE": id_mov});
}

window.onload = function() {
	gDiv = document.getElementById("movie");
	if(!window.mobilecheck()) {
		var l = document.links;
		for(var i=l.length - 1; i>0; i--) {
			if((/(avi|mpg|mkv|m4v|webm|mp4)$/gi).test(l[i].href)) {
				l[i].onclick = function(){ return mp_play(this); };
			}
		}
	}
	var tab = document.getElementsByClassName("indexcolname");
	for(var i = tab.length - 1; i >=0; i--) {
		tab[i].onmouseout = function() {
		//	gDiv.style = "";
		};
		tab[i].onmouseover = function() {
			get_file(this.innerText.replace(/\.[^/.]+$/, "").replace("/",""));
		};
	}
}

</script>
<div id="movie"></div>